-- 전체 테이블 삭제
-- SELECT 'DROP TABLE "' || TABLE_NAME || '" CASCADE CONSTRAINTS;' FROM user_tables; 

--DROP TABLE "BUSINESS_INFO" CASCADE CONSTRAINTS;
--DROP TABLE "DEAL" CASCADE CONSTRAINTS;
--DROP TABLE "PRODUCT" CASCADE CONSTRAINTS;
--DROP TABLE "LOCAL" CASCADE CONSTRAINTS;
--DROP TABLE "REVIEW" CASCADE CONSTRAINTS;
--DROP TABLE "NOTICE" CASCADE CONSTRAINTS;
--DROP TABLE "FAVORITE" CASCADE CONSTRAINTS;
--DROP TABLE "QNA" CASCADE CONSTRAINTS;
--DROP TABLE "REPORT" CASCADE CONSTRAINTS;
--DROP TABLE "CATEGORY" CASCADE CONSTRAINTS;
--DROP TABLE "CUSTOMER" CASCADE CONSTRAINTS;
--DROP TABLE "REPLY" CASCADE CONSTRAINTS;
--DROP TABLE "SB_CATEGORY" CASCADE CONSTRAINTS;
--DROP TABLE "SEARCHLIST" CASCADE CONSTRAINTS;
--DROP TABLE "CART" CASCADE CONSTRAINTS;
--DROP TABLE "SHAREBOARD" CASCADE CONSTRAINTS;

-- 전체 시퀀스 삭제
--SELECT 'DROP SEQUENCE"' || SEQUENCE_NAME || '";' FROM user_sequences;
--
--DROP SEQUENCE"R_NO";
--DROP SEQUENCE"SB_NO";
--DROP SEQUENCE"SEQ_CART";
--DROP SEQUENCE"SEQ_CNO";
--DROP SEQUENCE"SEQ_DEAL";
--DROP SEQUENCE"SEQ_NOTICE";
--DROP SEQUENCE"SEQ_PNO";
--DROP SEQUENCE"SEQ_QNO";
--DROP SEQUENCE"SEQ_REPORT";
--DROP SEQUENCE"SEQ_REVIEW";
--DROP SEQUENCE"SEQ_SEARCHLIST";

CREATE TABLE "BUSINESS_INFO" (
   "B_SHOP_NO"   VARCHAR2(40)      NOT NULL,
   "B_PERMIT"   VARCHAR2(30)   DEFAULT 'N'   NOT NULL,
   "B_SHOP_NAME"   VARCHAR2(100)      NOT NULL,
   "B_CLASS"   VARCHAR2(50)      NOT NULL,
   "B_DETAIL_CLASS"   VARCHAR2(50)      NOT NULL,
   "B_OWNER"   VARCHAR2(30)      NOT NULL,
   "B_PIC"   VARCHAR2(50)      NOT NULL,
   "B_SHOP_ADDRESS"   VARCHAR2(255)      NOT NULL,
   "C_NO"   NUMBER      NOT NULL
);

COMMENT ON COLUMN "BUSINESS_INFO"."B_SHOP_NO" IS '회원번호(사업자)';

COMMENT ON COLUMN "BUSINESS_INFO"."B_PERMIT" IS '승인여부';

COMMENT ON COLUMN "BUSINESS_INFO"."B_SHOP_NAME" IS '상호명';

COMMENT ON COLUMN "BUSINESS_INFO"."B_OWNER" IS '대표자이름';

COMMENT ON COLUMN "BUSINESS_INFO"."B_PIC" IS '담당자 연락처';

COMMENT ON COLUMN "BUSINESS_INFO"."B_SHOP_ADDRESS" IS '사업장주소';

COMMENT ON COLUMN "BUSINESS_INFO"."C_NO" IS '회원번호(일반)';

--DROP TABLE "SHAREBOARD";

-- SHAREBOARD 수정 (20.01.31.)
CREATE TABLE "SHAREBOARD" (
   "SB_NO"   NUMBER      NOT NULL,
   "SB_TITLE"   VARCHAR2(255)      NOT NULL,
   "SB_CONTENT"   VARCHAR2(255)      NOT NULL,
   "SB_CREATEDATE"   DATE      NULL,
   "SB_STATUS"   VARCHAR2(50)   DEFAULT 'Y'   NOT NULL,
   "C_NO"   NUMBER      NOT NULL,
   "L_CODE"   VARCHAR2(30)      NOT NULL,
   "SB_VIEW"   NUMBER      NULL,
   "SB_CG_CODE"   VARCHAR2(30)      NOT NULL,
   "ORIGINAL_FILE" varchar(100),
   "RENAME_FILENAME " varchar(100)
);

COMMENT ON COLUMN "SHAREBOARD"."SB_NO" IS '나눔번호';

COMMENT ON COLUMN "SHAREBOARD"."SB_TITLE" IS '글제목';

COMMENT ON COLUMN "SHAREBOARD"."SB_CONTENT" IS '글내용';

COMMENT ON COLUMN "SHAREBOARD"."SB_CREATEDATE" IS '등록일자';

COMMENT ON COLUMN "SHAREBOARD"."SB_STATUS" IS '상태';

COMMENT ON COLUMN "SHAREBOARD"."C_NO" IS '회원번호(일반)';

COMMENT ON COLUMN "SHAREBOARD"."L_CODE" IS '지역코드';

COMMENT ON COLUMN "SHAREBOARD"."SB_VIEW" IS '조회수';

COMMENT ON COLUMN "SHAREBOARD"."SB_CG_CODE" IS '말머리코드';

--DROP TABLE "DEAL";

CREATE TABLE "DEAL" (
   "D_NO"   NUMBER      NOT NULL,
   "D_DATE"   DATE      NULL,
   "P_NO"   NUMBER      NOT NULL,
   "C_NO"   NUMBER      NOT NULL,
   "D_PRICE"   NUMBER      NOT NULL,
   "D_AMOUNT"   NUMBER      NOT NULL,
   "D_METHOD"   VARCHAR2(50)      NOT NULL,
   "D_RECEIVER"   VARCHAR2(30)      NOT NULL,
   "D_REV_DATE"   DATE      NULL,
   "D_REV_CHECK"   VARCHAR2(30)      NOT NULL,
   "D_STATUS"   VARCHAR2(50)   DEFAULT 'Y'   NOT NULL,
   "D_UID" VARCHAR2(50)
);

COMMENT ON COLUMN "DEAL"."D_NO" IS '거래번호';

COMMENT ON COLUMN "DEAL"."D_DATE" IS '거래일자';

COMMENT ON COLUMN "DEAL"."P_NO" IS '상품고유번호';

COMMENT ON COLUMN "DEAL"."C_NO" IS '회원번호(일반)';

COMMENT ON COLUMN "DEAL"."D_PRICE" IS '결제금액';

COMMENT ON COLUMN "DEAL"."D_AMOUNT" IS '수량';

COMMENT ON COLUMN "DEAL"."D_METHOD" IS '결제방법';

COMMENT ON COLUMN "DEAL"."D_RECEIVER" IS '수령인';

COMMENT ON COLUMN "DEAL"."D_REV_DATE" IS '수령일자';

COMMENT ON COLUMN "DEAL"."D_REV_CHECK" IS '수령여부';

COMMENT ON COLUMN "DEAL"."D_STATUS" IS '결제 상태';

--DROP TABLE "PRODUCT";

CREATE TABLE "PRODUCT" (
   "P_NO"   NUMBER      NOT NULL,
   "P_NAME"   VARCHAR2(100)      NOT NULL,
   "P_THUMB"   VARCHAR2(100)      NULL,
   "P_ORIGINALPRICE"   NUMBER      NULL,
   "P_FINALPRICE"   NUMBER      NOT NULL,
   "P_AMOUNT"   NUMBER      NOT NULL,
   "P_INFO_IMAGE"   VARCHAR2(100)      NULL,
   "P_INFO_TEXT"   VARCHAR2(255)      NULL,
   "CG_CODE"   VARCHAR2(30)      NOT NULL,
   "P_DATE"   DATE      NULL,
   "P_STATUS"   VARCHAR(30)   DEFAULT 'Y'   NOT NULL,
   "L_CODE"   VARCHAR2(30)      NOT NULL,
   "P_STARRATE"   NUMBER   DEFAULT '0' NOT NULL,
   "P_ORIGIN"   VARCHAR2(100)      NOT NULL,
   "P_TITLE"   VARCHAR2(100)      NOT NULL,
   "P_BOARD"   VARCHAR2(50)      NOT NULL,
   "C_NO"   NUMBER      NOT NULL,
   "P_VOLUME" VARCHAR2(100),
   "P_PRODUCT_DATE" DATE,
   "P_TREATMENT" VARCHAR2(1000),
"P_START_DATE" DATE NULL,
"P_END_DATE" DATE NULL
);

COMMENT ON COLUMN "PRODUCT"."P_NO" IS '상품고유번호';

COMMENT ON COLUMN "PRODUCT"."P_NAME" IS '상품이름';

COMMENT ON COLUMN "PRODUCT"."P_THUMB" IS '썸네일';

COMMENT ON COLUMN "PRODUCT"."P_ORIGINALPRICE" IS '할인전가격';

COMMENT ON COLUMN "PRODUCT"."P_FINALPRICE" IS '최종판매가격';

COMMENT ON COLUMN "PRODUCT"."P_AMOUNT" IS '판매수량';

COMMENT ON COLUMN "PRODUCT"."P_INFO_IMAGE" IS '상품정보(이미지)';

COMMENT ON COLUMN "PRODUCT"."P_INFO_TEXT" IS '상품정보(텍스트)';

COMMENT ON COLUMN "PRODUCT"."CG_CODE" IS '카테고리코드';

COMMENT ON COLUMN "PRODUCT"."P_DATE" IS '등록일자';

COMMENT ON COLUMN "PRODUCT"."P_STATUS" IS '상태';

COMMENT ON COLUMN "PRODUCT"."L_CODE" IS '지역코드';

COMMENT ON COLUMN "PRODUCT"."C_NO" IS '회원번호(일반)';

--DROP TABLE "LOCAL";

CREATE TABLE "LOCAL" (
   "L_CODE"   VARCHAR2(30)      NOT NULL,
   "L_NAME"   VARCHAR2(100)      NULL
);

COMMENT ON COLUMN "LOCAL"."L_CODE" IS '지역코드';

COMMENT ON COLUMN "LOCAL"."L_NAME" IS '지역이름';

--DROP TABLE "REVIEW";

CREATE TABLE "REVIEW" (
   "RV_NO"   NUMBER      NOT NULL,
   "RV_STARRATE"   NUMBER      NULL,
   "RV_CONTENT"   VARCHAR2(255)      NOT NULL,
   "C_NO"   NUMBER      NOT NULL,
   "RV_STATUS"   VARCHAR2(30)   DEFAULT 'Y'   NOT NULL,
   "P_NO"   NUMBER      NOT NULL,
   "RV_ENROLLDATE"   DATE      NOT NULL
);

COMMENT ON COLUMN "REVIEW"."RV_NO" IS '리뷰번호';

COMMENT ON COLUMN "REVIEW"."RV_STARRATE" IS '평점';

COMMENT ON COLUMN "REVIEW"."RV_CONTENT" IS '리뷰내용';

COMMENT ON COLUMN "REVIEW"."C_NO" IS '회원번호(일반)';

COMMENT ON COLUMN "REVIEW"."RV_STATUS" IS '상태';

COMMENT ON COLUMN "REVIEW"."P_NO" IS '상품고유번호';

--DROP TABLE "NOTICE";

CREATE TABLE "NOTICE" (
   "N_NO"   NUMBER      NOT NULL,
   "N_TITLE"   VARCHAR2(100)      NULL,
   "N_CONTENT"   CLOB      NOT NULL,
   "N_DATE"   DATE      NULL,
   "N_STATUS"   VARCHAR2(30)   DEFAULT 'Y'   NOT NULL,
   "N_VIEW"   NUMBER      NULL
);

COMMENT ON COLUMN "NOTICE"."N_NO" IS '공지사항 번호';

COMMENT ON COLUMN "NOTICE"."N_TITLE" IS '글제목';

COMMENT ON COLUMN "NOTICE"."N_CONTENT" IS '글내용';

COMMENT ON COLUMN "NOTICE"."N_DATE" IS '작성일';

COMMENT ON COLUMN "NOTICE"."N_STATUS" IS '공지 게시글 상태';

COMMENT ON COLUMN "NOTICE"."N_VIEW" IS '조회수';

--DROP TABLE "FAVORITE";

CREATE TABLE "FAVORITE" (
   "P_NO"   NUMBER      NOT NULL,
   "C_NO"   NUMBER      NOT NULL
);

COMMENT ON COLUMN "FAVORITE"."P_NO" IS '상품고유번호';

COMMENT ON COLUMN "FAVORITE"."C_NO" IS '회원번호(일반)';

--DROP TABLE "CART";

CREATE TABLE "CART" (
   "P_NO"   NUMBER      NOT NULL,
   "C_NO"   NUMBER      NOT NULL
);

COMMENT ON COLUMN "CART"."P_NO" IS '상품고유번호';

COMMENT ON COLUMN "CART"."C_NO" IS '회원번호(일반)';

--DROP TABLE "QNA";

CREATE TABLE "QNA" (
   "Q_NO"   NUMBER      NOT NULL,
   "Q_TITLE"   VARCHAR2(100)      NULL,
   "Q_CONTENT"   VARCHAR2(1000)      NULL,
   "C_NO"   NUMBER      NOT NULL,
   "Q_ENROLLDATE"   DATE      NOT NULL,
   "Q_STATUS"   VARCHAR2(10) DEFAULT 'Y'      NOT NULL,
   "Q_REPLYDATE" DATE DEFAULT NULL
);

COMMENT ON COLUMN "QNA"."Q_NO" IS 'QNA번호';

COMMENT ON COLUMN "QNA"."Q_TITLE" IS '글제목';

COMMENT ON COLUMN "QNA"."Q_CONTENT" IS '글내용';

COMMENT ON COLUMN "QNA"."Q_ENROLLDATE" IS '글 등록날짜';

COMMENT ON COLUMN "QNA"."C_NO" IS '회원번호(일반)';

--DROP TABLE "REPORT";

CREATE TABLE "REPORT" (
   "RT_NO"   NUMBER      NOT NULL,
   "RT_TITLE"   VARCHAR2(100)      NULL,
   "RT_CONTENT"   VARCHAR2(255)      NULL,
   "RT_DATE"   DATE      NULL,
   "C_NO"   NUMBER      NOT NULL,
   "RT_CATEGORY"   VARCHAR2(50)      NULL,
   "RT_STATUS"   VARCHAR2(10)   DEFAULT 'Y'   NOT NULL,
   "RT_DIVIDE"   VARCHAR2(30)      NOT NULL,
   "RT_NUM"   NUMBER      NOT NULL
);

COMMENT ON COLUMN "REPORT"."RT_NO" IS '신고번호';

COMMENT ON COLUMN "REPORT"."RT_TITLE" IS '신고제목';

COMMENT ON COLUMN "REPORT"."RT_CONTENT" IS '신고내용';

COMMENT ON COLUMN "REPORT"."RT_DATE" IS '작성일';

COMMENT ON COLUMN "REPORT"."C_NO" IS '회원번호(일반)';

COMMENT ON COLUMN "REPORT"."RT_CATEGORY" IS '분류';

--DROP TABLE "CATEGORY";

CREATE TABLE "CATEGORY" (
   "CG_CODE"   VARCHAR2(30)      NOT NULL,
   "CG_NAME"   VARCHAR2(50)      NULL
);

COMMENT ON COLUMN "CATEGORY"."CG_CODE" IS '카테고리코드';

COMMENT ON COLUMN "CATEGORY"."CG_NAME" IS '카테고리이름';


--DROP TABLE "CUSTOMER";

CREATE TABLE "CUSTOMER" (
   "C_NO"   NUMBER      NOT NULL,
   "C_NAME"   VARCHAR2(30)      NOT NULL,
   "C_ID"   VARCHAR2(30)      NOT NULL,
   "C_PWD"   VARCHAR2(100)      NOT NULL,
   "C_EMAIL"   VARCHAR2(100)      NOT NULL,
   "C_ADDRESS"   VARCHAR2(255)      NOT NULL,
   "C_STATUS"   VARCHAR2(30)   DEFAULT 'Y'   NOT NULL,
   "C_PHONE"   VARCHAR2(50)      NOT NULL,
   "C_ENROLLDATE"   DATE      NOT NULL
 --  "C_LEVEL" VARCHAR2(30) NOT NULL
);

ALTER TABLE CUSTOMER ADD C_LEVEL VARCHAR2(20) DEFAULT '일반';
COMMENT ON COLUMN "CUSTOMER"."C_LEVEL" IS '회원 구분';

COMMENT ON COLUMN "CUSTOMER"."C_NO" IS '회원번호(일반)';

COMMENT ON COLUMN "CUSTOMER"."C_NAME" IS '이름';

COMMENT ON COLUMN "CUSTOMER"."C_ID" IS '아이디';

COMMENT ON COLUMN "CUSTOMER"."C_PWD" IS '비밀번호';

COMMENT ON COLUMN "CUSTOMER"."C_EMAIL" IS '이메일';

COMMENT ON COLUMN "CUSTOMER"."C_ADDRESS" IS '주소';

COMMENT ON COLUMN "CUSTOMER"."C_STATUS" IS '탈퇴여부';

COMMENT ON COLUMN "CUSTOMER"."C_PHONE" IS '전화번호';

COMMENT ON COLUMN "CUSTOMER"."C_ENROLLDATE" IS '일반회원 가입일자';


--DROP TABLE "REPLY";

CREATE TABLE "REPLY" (
   "R_NO"   NUMBER      NOT NULL,
   "SB_NO"   NUMBER      NOT NULL,
   "C_NO"   NUMBER      NOT NULL,
   "R_CREATEDATE"   DATE      NULL,
   "R_CONTENT"   VARCHAR2(255)      NULL,
   "R_STATUS"   VARCHAR2(30)   DEFAULT 'Y'   NOT NULL,
   "R_LEVEL"   NUMBER      NULL,
   "REF_RNO" NUMBER
);

COMMENT ON COLUMN "REPLY"."R_NO" IS '댓글번호';

COMMENT ON COLUMN "REPLY"."SB_NO" IS '나눔번호';

COMMENT ON COLUMN "REPLY"."C_NO" IS '회원번호(일반)';

COMMENT ON COLUMN "REPLY"."R_CREATEDATE" IS '댓글  등록일';

COMMENT ON COLUMN "REPLY"."R_CONTENT" IS '댓글내용';

COMMENT ON COLUMN "REPLY"."R_STATUS" IS '상태';

COMMENT ON COLUMN "REPLY"."R_LEVEL" IS '대댓글';

--DROP TABLE "SB_CATEGORY";

CREATE TABLE "SB_CATEGORY" (
   "SB_CG_CODE"   VARCHAR2(30)      NOT NULL,
   "SB_CG_NAME"   VARCHAR2(100)      NULL
);

COMMENT ON COLUMN "SB_CATEGORY"."SB_CG_CODE" IS '말머리코드';

COMMENT ON COLUMN "SB_CATEGORY"."SB_CG_NAME" IS '말머리이름';

CREATE TABLE SEARCHLIST(
    SEARCH_NO NUMBER PRIMARY KEY,
    SEARCHSTR VARCHAR2(100),
    SEARCHCOUNT NUMBER
);






ALTER TABLE "BUSINESS_INFO" ADD CONSTRAINT "PK_BUSINESS_INFO" PRIMARY KEY (
   "B_SHOP_NO"
);

ALTER TABLE "SHAREBOARD" ADD CONSTRAINT "PK_SHAREBOARD" PRIMARY KEY (
   "SB_NO"
);


ALTER TABLE "DEAL" ADD CONSTRAINT "PK_DEAL" PRIMARY KEY (
   "D_NO"
);

ALTER TABLE "PRODUCT" ADD CONSTRAINT "PK_PRODUCT" PRIMARY KEY (
   "P_NO"
);

ALTER TABLE "LOCAL" ADD CONSTRAINT "PK_LOCAL" PRIMARY KEY (
   "L_CODE"
);

ALTER TABLE "REVIEW" ADD CONSTRAINT "PK_REVIEW" PRIMARY KEY (
   "RV_NO"
);

ALTER TABLE "NOTICE" ADD CONSTRAINT "PK_NOTICE" PRIMARY KEY (
   "N_NO"
);

ALTER TABLE "FAVORITE" ADD CONSTRAINT "PK_FAVORITE" PRIMARY KEY (
   "P_NO",
   "C_NO"
);

ALTER TABLE "CART" ADD CONSTRAINT "PK_CART" PRIMARY KEY (
   "P_NO",
   "C_NO"
);

ALTER TABLE "QNA" ADD CONSTRAINT "PK_QNA" PRIMARY KEY (
   "Q_NO"
);

ALTER TABLE "REPORT" ADD CONSTRAINT "PK_REPORT" PRIMARY KEY (
   "RT_NO"
);

ALTER TABLE "CATEGORY" ADD CONSTRAINT "PK_CATEGORY" PRIMARY KEY (
   "CG_CODE"
);

ALTER TABLE "CUSTOMER" ADD CONSTRAINT "PK_CUSTOMER" PRIMARY KEY (
   "C_NO"
);

ALTER TABLE "REPLY" ADD CONSTRAINT "PK_REPLY" PRIMARY KEY (
   "R_NO"
);

ALTER TABLE "SB_CATEGORY" ADD CONSTRAINT "PK_SB_CATEGORY" PRIMARY KEY (
   "SB_CG_CODE"
);


ALTER TABLE "BUSINESS_INFO" ADD CONSTRAINT "FK_CUSTOMER_TO_BUSINESS_INFO_1" FOREIGN KEY (
   "C_NO"
)
REFERENCES "CUSTOMER" (
   "C_NO"
);

ALTER TABLE "SHAREBOARD" ADD CONSTRAINT "FK_CUSTOMER_TO_SHAREBOARD_1" FOREIGN KEY (
   "C_NO"
)
REFERENCES "CUSTOMER" (
   "C_NO"
);

ALTER TABLE "SHAREBOARD" ADD CONSTRAINT "FK_LOCAL_TO_SHAREBOARD_1" FOREIGN KEY (
   "L_CODE"
)
REFERENCES "LOCAL" (
   "L_CODE"
);

ALTER TABLE "SHAREBOARD" ADD CONSTRAINT "FK_SB_CATEGORY_TO_SHAREBOARD_1" FOREIGN KEY (
   "SB_CG_CODE"
)
REFERENCES "SB_CATEGORY" (
   "SB_CG_CODE"
);





ALTER TABLE "DEAL" ADD CONSTRAINT "FK_PRODUCT_TO_DEAL_1" FOREIGN KEY (
   "P_NO"
)
REFERENCES "PRODUCT" (
   "P_NO"
);

ALTER TABLE "DEAL" ADD CONSTRAINT "FK_CUSTOMER_TO_DEAL_1" FOREIGN KEY (
   "C_NO"
)
REFERENCES "CUSTOMER" (
   "C_NO"
);

ALTER TABLE "PRODUCT" ADD CONSTRAINT "FK_CATEGORY_TO_PRODUCT_1" FOREIGN KEY (
   "CG_CODE"
)
REFERENCES "CATEGORY" (
   "CG_CODE"
);

ALTER TABLE "PRODUCT" ADD CONSTRAINT "FK_LOCAL_TO_PRODUCT_1" FOREIGN KEY (
   "L_CODE"
)
REFERENCES "LOCAL" (
   "L_CODE"
);

ALTER TABLE "PRODUCT" ADD CONSTRAINT "FK_CUSTOMER_TO_PRODUCT_1" FOREIGN KEY (
   "C_NO"
)
REFERENCES "CUSTOMER" (
   "C_NO"
);

ALTER TABLE "REVIEW" ADD CONSTRAINT "FK_CUSTOMER_TO_REVIEW_1" FOREIGN KEY (
   "C_NO"
)
REFERENCES "CUSTOMER" (
   "C_NO"
);

ALTER TABLE "REVIEW" ADD CONSTRAINT "FK_PRODUCT_TO_REVIEW_1" FOREIGN KEY (
   "P_NO"
)
REFERENCES "PRODUCT" (
   "P_NO"
);

ALTER TABLE "FAVORITE" ADD CONSTRAINT "FK_PRODUCT_TO_FAVORITE_1" FOREIGN KEY (
   "P_NO"
)
REFERENCES "PRODUCT" (
   "P_NO"
);

ALTER TABLE "FAVORITE" ADD CONSTRAINT "FK_CUSTOMER_TO_FAVORITE_1" FOREIGN KEY (
   "C_NO"
)
REFERENCES "CUSTOMER" (
   "C_NO"
);

ALTER TABLE "CART" ADD CONSTRAINT "FK_PRODUCT_TO_CART_1" FOREIGN KEY (
   "P_NO"
)
REFERENCES "PRODUCT" (
   "P_NO"
);

ALTER TABLE "CART" ADD CONSTRAINT "FK_CUSTOMER_TO_CART_1" FOREIGN KEY (
   "C_NO"
)
REFERENCES "CUSTOMER" (
   "C_NO"
);

ALTER TABLE "QNA" ADD CONSTRAINT "FK_CUSTOMER_TO_QNA_1" FOREIGN KEY (
   "C_NO"
)
REFERENCES "CUSTOMER" (
   "C_NO"
);

ALTER TABLE "REPORT" ADD CONSTRAINT "FK_CUSTOMER_TO_REPORT_1" FOREIGN KEY (
   "C_NO"
)
REFERENCES "CUSTOMER" (
   "C_NO"
);

ALTER TABLE "REPLY" ADD CONSTRAINT "FK_SHAREBOARD_TO_REPLY_1" FOREIGN KEY (
   "SB_NO"
)
REFERENCES "SHAREBOARD" (
   "SB_NO"
);

ALTER TABLE "REPLY" ADD CONSTRAINT "FK_CUSTOMER_TO_REPLY_1" FOREIGN KEY (
   "C_NO"
)
REFERENCES "CUSTOMER" (
   "C_NO"
);


DROP TABLE "CART";

-- TABLE CART 수정 (20.01.31.)
  CREATE TABLE "BUYLOCAL"."CART" 
   (   "CART_NO" NUMBER NOT NULL ENABLE, 
   "C_NO" NUMBER NOT NULL ENABLE, 
   "P_NO" NUMBER NOT NULL ENABLE, 
   "QUANTITY" NUMBER NOT NULL ENABLE, 
    CONSTRAINT "PK_CART" PRIMARY KEY ("CART_NO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE, 
    CONSTRAINT "FK_PRODUCT_TO_CART_1" FOREIGN KEY ("P_NO")
     REFERENCES "BUYLOCAL"."PRODUCT" ("P_NO") ENABLE, 
    CONSTRAINT "FK_CUSTOMER_TO_CART_1" FOREIGN KEY ("C_NO")
     REFERENCES "BUYLOCAL"."CUSTOMER" ("C_NO") ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;

   COMMENT ON COLUMN "BUYLOCAL"."CART"."C_NO" IS '회원번호(일반)';
   COMMENT ON COLUMN "BUYLOCAL"."CART"."P_NO" IS '상품고유번호';




CREATE OR REPLACE VIEW PD_VIEW 
AS SELECT P_NO, P_NAME, P_THUMB, P_ORIGINALPRICE, P_FINALPRICE, P_AMOUNT, P_INFO_IMAGE, 
P_INFO_TEXT, CG_NAME, P_DATE, P_STATUS, L_NAME, B_OWNER, 
B_SHOP_ADDRESS, C_PHONE, P_STARRATE, P_ORIGIN, P_TITLE, P_BOARD
FROM PRODUCT JOIN CATEGORY USING(CG_CODE) JOIN LOCAL USING(L_CODE)
JOIN CUSTOMER USING (C_NO) JOIN BUSINESS_INFO USING(C_NO);

-- 상품 상세 정보 포함 
CREATE OR REPLACE VIEW PD_VIEW2 
AS SELECT P_NO, P_NAME, P_THUMB, P_ORIGINALPRICE, P_FINALPRICE, P_AMOUNT, P_INFO_IMAGE, 
P_INFO_TEXT, CG_NAME, P_DATE, P_STATUS, L_NAME, B_OWNER, B_SHOP_NO, B_SHOP_NAME,
B_SHOP_ADDRESS, P_VOLUME, P_PRODUCT_DATE, P_TREATMENT, B_PIC, P_STARRATE, P_ORIGIN, P_TITLE, P_BOARD
FROM PRODUCT 
JOIN CATEGORY USING(CG_CODE) 
JOIN LOCAL USING(L_CODE)
JOIN CUSTOMER USING (C_NO)
JOIN BUSINESS_INFO USING(C_NO);



-- CATEGORY 더미값 
INSERT INTO CATEGORY
VALUES ('C1', '디지털/가전');

INSERT INTO CATEGORY
VALUES ('C2', '의류/패션잡화');

INSERT INTO CATEGORY
VALUES ('C3', '뷰티/미용');

INSERT INTO CATEGORY
VALUES ('C4', '스포츠/레저');

INSERT INTO CATEGORY
VALUES ('C5', '도서/티켓/음반');

INSERT INTO CATEGORY
VALUES ('C6', '가구/인테리어');

INSERT INTO CATEGORY
VALUES ('C7', '신선/가공식품');

INSERT INTO CATEGORY
VALUES ('C8', '게임/취미');

INSERT INTO CATEGORY
VALUES ('C9', '반려동물용품');

INSERT INTO CATEGORY
VALUES ('C10', '기타');

INSERT INTO CATEGORY
VALUES('T1', '한식');

INSERT INTO CATEGORY
VALUES('T2', '중식');

INSERT INTO CATEGORY
VALUES('T3', '일식');

INSERT INTO CATEGORY
VALUES('T4', '양식');

INSERT INTO CATEGORY
VALUES('T5', '커피/제과');

INSERT INTO CATEGORY
VALUES('T6', '땡처리기타');

COMMIT;

-- LOCAL 더미값
INSERT INTO LOCAL
VALUES ('L1', '종로구');

INSERT INTO LOCAL
VALUES ('L2', '중구');

INSERT INTO LOCAL
VALUES ('L3', '용산구');

INSERT INTO LOCAL
VALUES ('L4', '성동구');

INSERT INTO LOCAL
VALUES ('L5', '광진구');

INSERT INTO LOCAL
VALUES ('L6', '동대문구');

INSERT INTO LOCAL
VALUES ('L7', '중랑구');

INSERT INTO LOCAL
VALUES ('L8', '성북구');

INSERT INTO LOCAL
VALUES ('L9', '강북구');

INSERT INTO LOCAL
VALUES ('L10', '도봉구');

INSERT INTO LOCAL
VALUES ('L11', '노원구');

INSERT INTO LOCAL
VALUES ('L12', '은평구');

INSERT INTO LOCAL
VALUES ('L13', '서대문구');

INSERT INTO LOCAL
VALUES ('L14', '마포구');

INSERT INTO LOCAL
VALUES ('L15', '양천구');

INSERT INTO LOCAL
VALUES ('L16', '강서구');

INSERT INTO LOCAL
VALUES ('L17', '구로구');

INSERT INTO LOCAL
VALUES ('L18', '금천구');

INSERT INTO LOCAL
VALUES ('L19', '영등포구');

INSERT INTO LOCAL
VALUES ('L20', '동작구');

INSERT INTO LOCAL
VALUES ('L21', '관악구');

INSERT INTO LOCAL
VALUES ('L22', '서초구');

INSERT INTO LOCAL
VALUES ('L23', '강남구');

INSERT INTO LOCAL
VALUES ('L24', '송파구');

INSERT INTO LOCAL
VALUES ('L25', '강동구');

commit;

-- CUSTOMER 더미값 (사이트에서 직접 회원가입 해, 생성하기, 업종/업태 무시)
-- (관리자 계정에서 사업자번호 확인 후 승인 처리 - C_LEVEL 변경)

-- PRODUCT 더미값(회원가입 이후 생성)

-- DEAL 더미값(회원가입 이후 생성)

--REVIEW 더미 (회원가입 이후  생성)

-- SHAREBOARD 더미값 (20.01.21. 추가) (회원가입 이후  생성)

-- QNA 더미값 (회원가입 이후  생성)


-- NOTICE 더미값 
INSERT INTO NOTICE
VALUES (1, '땡처리/핫딜/나눔게시판 이용 방법', '이용방법은 다음과 같습니다', SYSDATE, DEFAULT, 10);  

INSERT INTO NOTICE
VALUES (2, '사행성 광고글 및 불량 회원, 게시글 신고방법', '관리자에게 즉시 신고 바랍니다.', SYSDATE, DEFAULT, 11);

INSERT INTO NOTICE
VALUES (3, '광고 및 이벤트 신청방법', '광고 신청 페이지에서 신청 가능합니다.', SYSDATE, DEFAULT, 1);

INSERT INTO NOTICE
VALUES (4, '상품 등록 방법', '다음과 같이 상품을 등록 할 수 있습니다.', SYSDATE, DEFAULT, 1);

COMMIT;


-- SB_CATEGORY 더미값
INSERT INTO SB_CATEGORY
VALUES ('SB1', '삽니다');

INSERT INTO SB_CATEGORY
VALUES ('SB2', '팝니다');

INSERT INTO SB_CATEGORY
VALUES ('SB3', '나눕니다');

INSERT INTO SB_CATEGORY
VALUES ('SB4', '기타');

INSERT INTO SB_CATEGORY
VALUES ('SB5', '정보공유');
COMMIT;


-- SEQUENCE 구문추가

CREATE SEQUENCE SEQ_CNO
START WITH 10
INCREMENT BY 1
NOCYCLE
NOCACHE;

CREATE SEQUENCE SEQ_CART
START WITH 1
INCREMENT BY 1
NOCYCLE
NOCACHE;

CREATE SEQUENCE SEQ_DEAL
START WITH 1
INCREMENT BY 1
NOCYCLE
NOCACHE;

CREATE SEQUENCE SEQ_REVIEW
START WITH 1
INCREMENT BY 1
NOCYCLE
NOCACHE;

CREATE SEQUENCE SEQ_NOTICE
START WITH 1
INCREMENT BY 1
NOCYCLE
NOCACHE;

CREATE SEQUENCE SEQ_REPORT
START WITH 1
INCREMENT BY 1
NOCYCLE
NOCACHE;

CREATE SEQUENCE SEQ_PNO
START WITH 1
INCREMENT BY 1
NOCYCLE
NOCACHE;

CREATE SEQUENCE SEQ_QNO
START WITH 1
INCREMENT BY 1
NOCYCLE
NOCACHE;

CREATE SEQUENCE R_NO
START WITH 1
INCREMENT BY 1
NOCYCLE
NOCACHE;

-- 시퀀스 추가 20.01.31.
CREATE SEQUENCE SEQ_SEARCHLIST
START WITH 1
INCREMENT BY 1
NOCYCLE
NOCACHE;

CREATE SEQUENCE SB_NO
START WITH 30
INCREMENT BY 1
NOCYCLE
NOCACHE;

-- TRIGGER 추가
create or replace TRIGGER REDUCE_PRO
AFTER INSERT ON DEAL
FOR EACH ROW
BEGIN
IF :NEW.D_AMOUNT > 0
    THEN 
    UPDATE PRODUCT 
    SET P_AMOUNT = P_AMOUNT - :NEW.D_AMOUNT
    WHERE P_NO = :NEW.P_NO;
END IF;
END;
